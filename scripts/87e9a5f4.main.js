function ab2str(a){var b,c,d,e="",f=new Uint16Array(a),g=f.length,h=Math.pow(2,16);for(b=0;g>b;b+=h)c=Math.min(h,g-b),d=f.subarray(b,b+c),e+=String.fromCharCode.apply(null,d);return e}function str2ab(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;e>d;d++)c[d]=a.charCodeAt(d);return b}function init(){console.log("'Allo 'main!");var a=new Slicedrop2;a.init()}var COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_DEFINES,goog.define=function(a,b){var c=b;COMPILED||goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]),goog.exportPath_(a,c)},goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a];for(var b=a;(b=b.substring(0,b.lastIndexOf(".")))&&!goog.getObjectByName(b);)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)},goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||"",Error(": "+a)},COMPILED||(goog.isProvided_=function(a){return!goog.implicitNamespaces_[a]&&!!goog.getObjectByName(a)},goog.implicitNamespaces_={}),goog.exportPath_=function(a,b,c){var d=a.split("."),e=c||goog.global;d[0]in e||!e.execScript||e.execScript("var "+d[0]);for(var f;d.length&&(f=d.shift());)!d.length&&goog.isDef(b)?e[f]=b:e=e[f]?e[f]:e[f]={}},goog.getObjectByName=function(a,b){for(var c,d=a.split("."),e=b||goog.global;c=d.shift();){if(!goog.isDefAndNotNull(e[c]))return null;e=e[c]}return e},goog.globalize=function(a,b){var c=b||goog.global;for(var d in a)c[d]=a[d]},goog.addDependency=function(a,b,c){if(!COMPILED){for(var d,e,f=a.replace(/\\/g,"/"),g=goog.dependencies_,h=0;d=b[h];h++)g.nameToPath[d]=f,f in g.pathToNames||(g.pathToNames[f]={}),g.pathToNames[f][d]=!0;for(var i=0;e=c[i];i++)f in g.requires||(g.requires[f]={}),g.requires[f][e]=!0}},goog.ENABLE_DEBUG_LOADER=!0,goog.require=function(a){if(!COMPILED){if(goog.isProvided_(a))return;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,void goog.writeScripts_()}var c="goog.require could not find: "+a;throw goog.global.console&&goog.global.console.error(c),Error(c)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(a){return a},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(a){a.getInstance=function(){return a.instance_?a.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a),a.instance_=new a)}},goog.instantiatedSingletons_=[],!COMPILED&&goog.ENABLE_DEBUG_LOADER&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)return void(goog.basePath=goog.global.CLOSURE_BASE_PATH);if(goog.inHtmlDocument_())for(var a=goog.global.document,b=a.getElementsByTagName("script"),c=b.length-1;c>=0;--c){var d=b[c].src,e=d.lastIndexOf("?"),f=-1==e?d.length:e;if("base.js"==d.substr(f-7,7))return void(goog.basePath=d.substr(0,f-7))}},goog.importScript_=function(a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[a]&&b(a)&&(goog.dependencies_.written[a]=!0)},goog.writeScriptTag_=function(a){if(goog.inHtmlDocument_()){var b=goog.global.document;if("complete"==b.readyState){var c=/\bdeps.js$/.test(a);if(c)return!1;throw Error('Cannot write "'+a+'" after document load')}return b.write('<script type="text/javascript" src="'+a+'"></script>'),!0}return!1},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(e in d.visited)return void(e in c||(c[e]=!0,b.push(e)));if(d.visited[e]=!0,e in d.requires)for(var f in d.requires[e])if(!goog.isProvided_(f)){if(!(f in d.nameToPath))throw Error("Undefined nameToPath for "+f);a(d.nameToPath[f])}e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_;for(var e in goog.included_)d.written[e]||a(e);for(var f=0;f<b.length;f++){if(!b[f])throw Error("Undefined script input");goog.importScript_(goog.basePath+b[f])}},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.typeOf=function(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b},goog.isDef=function(a){return void 0!==a},goog.isNull=function(a){return null===a},goog.isDefAndNotNull=function(a){return null!=a},goog.isArray=function(a){return"array"==goog.typeOf(a)},goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length},goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear},goog.isString=function(a){return"string"==typeof a},goog.isBoolean=function(a){return"boolean"==typeof a},goog.isNumber=function(a){return"number"==typeof a},goog.isFunction=function(a){return"function"==goog.typeOf(a)},goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var c="array"==b?[]:{};for(var d in a)c[d]=goog.cloneObject(a[d]);return c}return a},goog.bindNative_=function(a){return a.call.apply(a.bind,arguments)},goog.bindJs_=function(a,b){if(!a)throw new Error;if(arguments.length>2){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(d,c),a.apply(b,d)}}return function(){return a.apply(b,arguments)}},goog.bind=function(){return goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bindNative_:goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=Array.prototype.slice.call(arguments);return c.unshift.apply(c,b),a.apply(this,c)}},goog.mixin=function(a,b){for(var c in b)a[c]=b[c]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript",c.defer=!1,c.appendChild(b.createTextNode(a)),b.body.appendChild(c),b.body.removeChild(c)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(a,b){var c,d=function(a){return goog.cssNameMapping_[a]||a},e=function(a){for(var b=a.split("-"),c=[],e=0;e<b.length;e++)c.push(d(b[e]));return c.join("-")};return c=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?d:e:function(a){return a},b?a+"-"+c(b):c(a)},goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a,goog.cssNameMappingStyle_=b},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(a,b){var c=b||{};for(var d in c){var e=(""+c[d]).replace(/\$/g,"$$$$");a=a.replace(new RegExp("\\{\\$"+d+"\\}","gi"),e)}return a},goog.getMsgWithFallback=function(a){return a},goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)},goog.exportProperty=function(a,b,c){a[b]=c},goog.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a},goog.base=function(a,b){var c=arguments.callee.caller;if(goog.DEBUG&&!c)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(c.superClass_)return c.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var d=Array.prototype.slice.call(arguments,2),e=!1,f=a.constructor;f;f=f.superClass_&&f.superClass_.constructor)if(f.prototype[b]===c)e=!0;else if(e)return f.prototype[b].apply(a,d);if(a[b]===c)return a.constructor.prototype[b].apply(a,d);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(a){a.call(goog.global)},goog.addDependency("../../../../X.js",["X","X.counter"],[]),goog.addDependency("../../../../core/base.js",["X.base"],["X","goog.events","goog.events.EventTarget"]),goog.addDependency("../../../../core/colortable.js",["X.colortable"],["X.base","X.loadable","goog.structs.Map"]),goog.addDependency("../../../../core/event.js",["X.event","X.event.ComputingEndEvent","X.event.ComputingEvent","X.event.ComputingProgressEvent","X.event.HoverEndEvent","X.event.HoverEvent","X.event.ModifiedEvent","X.event.PanEvent","X.event.ProgressEvent","X.event.RenderEvent","X.event.ResetViewEvent","X.event.RotateEvent","X.event.ScrollEvent","X.event.WindowLevelEvent","X.event.ZoomEvent","X.event.events"],["X","X.object","X.vector","goog.events","goog.events.Event"]),goog.addDependency("../../../../core/file.js",["X.file"],["X.base"]),goog.addDependency("../../../../core/scalars.js",["X.scalars"],["X.base","X.loadable","X.thresholdable"]),goog.addDependency("../../../../core/texture.js",["X.texture"],["X.base","X.loadable"]),goog.addDependency("../../../../core/transform.js",["X.transform"],["X.base","X.matrix"]),goog.addDependency("../../../../core/triplets.js",["X.triplets"],["X.base"]),goog.addDependency("../../../../injects/constructable.js",["X.constructable"],["CSG","X.base","X.object","csgPolygon","csgVector","csgVertex"]),goog.addDependency("../../../../injects/displayable.js",["X.displayable"],["X.base","X.texture","X.transform","X.triplets"]),goog.addDependency("../../../../injects/loadable.js",["X.loadable"],["X.base","X.file"]),goog.addDependency("../../../../injects/thresholdable.js",["X.thresholdable"],["X.base"]),goog.addDependency("../../../../io/interactor.js",["X.interactor"],["X.base","X.event","X.event.HoverEndEvent","X.event.HoverEvent","X.event.PanEvent","X.event.ResetViewEvent","X.event.RotateEvent","X.event.ZoomEvent","goog.dom","goog.events","goog.events.BrowserEvent.MouseButton","goog.events.EventType","goog.events.KeyHandler","goog.events.MouseWheelHandler","goog.math.Vec3"]),goog.addDependency("../../../../io/interactor2D.js",["X.interactor2D"],["X.event.ScrollEvent","X.interactor"]),goog.addDependency("../../../../io/interactor3D.js",["X.interactor3D"],["X.interactor"]),goog.addDependency("../../../../io/loader.js",["X.loader"],["X.base","X.event","X.object","X.parserCRV","X.parserDCM","X.parserFSM","X.parserIMAGE","X.parserLBL","X.parserLUT","X.parserMGZ","X.parserNII","X.parserNRRD","X.parserOBJ","X.parserOFF","X.parserSTL","X.parserTRK","X.parserVTK","goog.structs.Map"]),goog.addDependency("../../../../io/parser.js",["X.parser"],["X.base","X.event","X.texture","X.triplets","goog.vec.Mat4","goog.vec.Vec3","goog.vec.Vec4"]),goog.addDependency("../../../../io/parserCRV.js",["X.parserCRV"],["X.event","X.parser","X.triplets"]),goog.addDependency("../../../../io/parserDCM.js",["X.parserDCM"],["X.event","X.object","X.parser","X.triplets","goog.math.Vec3"]),goog.addDependency("../../../../io/parserFSM.js",["X.parserFSM"],["X.event","X.object","X.parser","X.triplets","goog.math.Vec3"]),goog.addDependency("../../../../io/parserIMAGE.js",["X.parserIMAGE"],["X.event","X.parser"]),goog.addDependency("../../../../io/parserLBL.js",["X.parserLBL"],["X.event","X.parser","X.triplets"]),goog.addDependency("../../../../io/parserLUT.js",["X.parserLUT"],["X.event","X.parser","X.triplets"]),goog.addDependency("../../../../io/parserMGZ.js",["X.parserMGZ"],["X.event","X.object","X.parser","X.triplets","Zlib.Gunzip","goog.math.Vec3"]),goog.addDependency("../../../../io/parserNII.js",["X.parserNII"],["X.event","X.object","X.parser","X.triplets","Zlib.Gunzip","goog.vec.Mat3","goog.vec.Mat4"]),goog.addDependency("../../../../io/parserNRRD.js",["X.parserNRRD"],["X.event","X.object","X.parser","X.triplets","Zlib.Gunzip","goog.math.Vec3","goog.vec.Vec4"]),goog.addDependency("../../../../io/parserOBJ.js",["X.parserOBJ"],["X.event","X.object","X.parser","X.triplets"]),goog.addDependency("../../../../io/parserOFF.js",["X.parserOFF"],["X.event","X.object","X.parser","X.triplets"]),goog.addDependency("../../../../io/parserSTL.js",["X.parserSTL"],["X.event","X.parser","X.triplets"]),goog.addDependency("../../../../io/parserTRK.js",["X.parserTRK"],["X.event","X.parser","X.triplets","goog.math.Vec3"]),goog.addDependency("../../../../io/parserVTK.js",["X.parserVTK"],["X.event","X.object","X.parser","X.triplets"]),goog.addDependency("../../../../math/array.js",["X.array"],["X.base"]),goog.addDependency("../../../../math/matrix.js",["X.matrix"],["X.vector","goog.vec.Mat4"]),goog.addDependency("../../../../math/vector.js",["X.vector"],["goog.math.Vec3"]),goog.addDependency("../../../../objects/cube.js",["X.cube"],["CSG.cube","X.base","X.constructable","X.object"]),goog.addDependency("../../../../objects/cylinder.js",["X.cylinder"],["CSG.cylinder","X.base","X.constructable","X.object"]),goog.addDependency("../../../../objects/fibers.js",["X.fibers"],["X.object"]),goog.addDependency("../../../../objects/labelmap.js",["X.labelmap"],["X.volume"]),goog.addDependency("../../../../objects/mesh.js",["X.mesh"],["X.object"]),goog.addDependency("../../../../objects/object.js",["X.object"],["X.base","X.colortable","X.displayable","X.indexer","X.loadable","X.scalars"]),goog.addDependency("../../../../objects/slice.js",["X.slice"],["X.base","X.object","goog.math.Vec3"]),goog.addDependency("../../../../objects/sphere.js",["X.sphere"],["CSG.sphere","X.base","X.constructable","X.object"]),goog.addDependency("../../../../objects/volume.js",["X.volume"],["X.object","X.parser","X.slice","X.thresholdable"]),goog.addDependency("../../../../ui/caption.js",["X.caption"],["X.base","X.interactor","goog.dom","goog.positioning.ViewportPosition","goog.style","goog.ui.Tooltip"]),goog.addDependency("../../../../ui/progressbar.js",["X.progressbar"],["X.base","goog.dom","goog.style","goog.ui.ProgressBar"]),goog.addDependency("../../../../visualization/buffer.js",["X.buffer"],["X.base"]),goog.addDependency("../../../../visualization/camera.js",["X.camera"],["X.base","X.event.PanEvent","X.event.RenderEvent","X.event.ZoomEvent","X.interactor","X.matrix","X.vector"]),goog.addDependency("../../../../visualization/camera2D.js",["X.camera2D"],["X.camera","X.event.WindowLevelEvent"]),goog.addDependency("../../../../visualization/camera3D.js",["X.camera3D"],["X.camera","X.event.RotateEvent","X.matrix"]),goog.addDependency("../../../../visualization/indexer.js",["X.indexer"],["X.base"]),goog.addDependency("../../../../visualization/renderer.js",["X.renderer"],["X.array","X.base","X.camera","X.camera2D","X.camera3D","X.cube","X.cylinder","X.event","X.interactor","X.interactor2D","X.interactor3D","X.labelmap","X.loader","X.object","X.progressbar","X.sphere","X.volume","goog.Timer","goog.dom","goog.events","goog.events.EventType"]),goog.addDependency("../../../../visualization/renderer2D.js",["X.renderer2D"],["X.renderer","goog.math.Vec3","goog.vec.Vec4"]),goog.addDependency("../../../../visualization/renderer3D.js",["X.renderer3D"],["X.buffer","X.caption","X.matrix","X.renderer","X.shaders","X.triplets","X.vector","goog.structs.Map","goog.style"]),goog.addDependency("../../../../visualization/shaders.js",["X.shaders"],["X.base"]),goog.addDependency("../../../csg/csg.js",["CSG"],["csgNode","csgPolygon"]),goog.addDependency("../../../csg/cube.js",["CSG.cube"],["CSG","csgPolygon","csgVector","csgVertex"]),goog.addDependency("../../../csg/cylinder.js",["CSG.cylinder"],["CSG","csgPolygon","csgVector","csgVertex"]),goog.addDependency("../../../csg/node.js",["csgNode"],["csgPlane","csgPolygon"]),goog.addDependency("../../../csg/plane.js",["csgPlane"],["csgVector"]),goog.addDependency("../../../csg/polygon.js",["csgPolygon"],["csgPlane","csgVertex"]),goog.addDependency("../../../csg/sphere.js",["CSG.sphere"],["CSG","csgPolygon","csgVector","csgVertex"]),goog.addDependency("../../../csg/vector.js",["csgVector"],[]),goog.addDependency("../../../csg/vertex.js",["csgVertex"],["csgVector"]),goog.addDependency("../../../zlib.js/adler32.js",["Zlib.Adler32"],[]),goog.addDependency("../../../zlib.js/bitstream.js",["Zlib.BitStream"],[]),goog.addDependency("../../../zlib.js/crc32.js",["Zlib.CRC32"],["USE_TYPEDARRAY"]),goog.addDependency("../../../zlib.js/deflate.js",["Zlib.Deflate"],["Zlib.Adler32","Zlib.RawDeflate"]),goog.addDependency("../../../zlib.js/gunzip.js",["Zlib.Gunzip"],["Zlib.CRC32","Zlib.GunzipMember","Zlib.Gzip","Zlib.RawInflate"]),goog.addDependency("../../../zlib.js/gzip.js",["Zlib.Gzip"],["Zlib.CRC32","Zlib.RawDeflate"]),goog.addDependency("../../../zlib.js/gzip_member.js",["Zlib.GunzipMember"],[]),goog.addDependency("../../../zlib.js/heap.js",["Zlib.Heap"],[]),goog.addDependency("../../../zlib.js/huffman.js",["Zlib.Huffman"],[]),goog.addDependency("../../../zlib.js/inflate.js",["Zlib.Inflate"],["Zlib","Zlib.Adler32","Zlib.RawInflate"]),goog.addDependency("../../../zlib.js/inflate_stream.js",["Zlib.InflateStream"],["Zlib.RawInflateStream"]),goog.addDependency("../../../zlib.js/rawdeflate.js",["Zlib.RawDeflate"],["Zlib.BitStream","Zlib.Heap"]),goog.addDependency("../../../zlib.js/rawinflate.js",["Zlib.RawInflate"],["Zlib.Huffman"]),goog.addDependency("../../../zlib.js/rawinflate_stream.js",["Zlib.RawInflateStream"],["Zlib.Huffman"]),goog.addDependency("../../../zlib.js/use.js",["USE_TYPEDARRAY"],[]),goog.addDependency("../../../zlib.js/util.js",["Zlib.Util"],[]),goog.addDependency("../../../zlib.js/zlib.js",["Zlib"],["Zlib.Deflate","Zlib.Inflate"]);var Db=function(){this.db=null};Db.prototype.onerror=function(a){console.log(a.value)},Db.prototype.open=function(){var a=this,b=5,c=indexedDB.open("slicedrop",b);c.onupgradeneeded=function(b){var c=b.target.result;b.target.transaction.onerror=a.onerror,c.objectStoreNames.contains("data")&&c.deleteObjectStore("data");c.createObjectStore("data",{keyPath:"uid"})},c.onsuccess=function(b){a.db=b.target.result;var c=new Event("dbLoaded");document.dispatchEvent(c)},c.onerror=this.onerror},Db.prototype.addData=function(a){var b=this.db,c=b.transaction(["data"],"readwrite"),d=c.objectStore("data"),e=a;e.timeStamp=(new Date).getTime();var f=d.put(e);f.onsuccess=function(){var a=new Event("dbAdded");document.dispatchEvent(a)},f.onerror=this.onerror},Db.prototype.getAllDataItems=function(a){var b=this.db,c=b.transaction(["data"],"readwrite"),d=c.objectStore("data"),e=IDBKeyRange.lowerBound(0),f=d.openCursor(e);f.onsuccess=a,f.onerror=this.onerror},Db.prototype.deleteData=function(a){var b=this.db,c=b.transaction(["data"],"readwrite"),d=c.objectStore("data"),e=d.delete(a);e.onsuccess=function(){var a=new Event("dbRemoved");document.dispatchEvent(a)},e.onerror=this.onerror},goog.require("X.parserDCM"),goog.require("X.parser");var Upload=function(a){this.files=[],this.filesLoaded=[],this.totalSize=0,this.totalProgress=0,this.db=a};Upload.prototype.setup=function(){window.console.log("setup - setup"),this.setupFileDrop(),this.setupFileSelect()},Upload.prototype.addFile=function(a){this.files.push(a),this.totalSize+=a.size},Upload.prototype.work=function(a){this.addFile(a);var b=new Worker("scripts/ww_load.js"),c=this;b.onmessage=function(b){if("progress"===b.data.status);else if("load"===b.data.status){window.console.log(a.name+" loaded!!!");var d={name:escape(a.name),size:a.size,file:a,content:b.data.content};c.filesLoaded.push(d);var e=new X.parserDCM,f=b.data.content;f.byteLength=a.size;var g=new X.file,h=new X.object;h._file=[];var i={};e.parse(g,h,f,i),d.uid=h.slices[0].sop_instance_uid,d.file=null,d.content=d.content,c.db.addData(d)}},b.postMessage(a)},Upload.prototype.setupFileDrop=function(){function a(a){a.stopPropagation(),a.preventDefault(),a.target.style.border="";for(var b,c=a.dataTransfer.files,d=0;b=c[d];d++){var f={name:escape(b.name),size:b.size,uploaded:-1,file:b};e.work(f)}}function b(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function c(a){a.stopPropagation(),a.preventDefault(),a.target.style.border="3px solid black"}function d(a){a.stopPropagation(),a.preventDefault(),a.target.style.border=""}window.console.log("setup - setupFileDrop");var e=this,f=document.getElementById("drop_zone");f.addEventListener("dragover",b,!1),f.addEventListener("drop",a,!1),f.addEventListener("dragenter",c,!1),f.addEventListener("dragleave",d,!1)},Upload.prototype.setupFileSelect=function(){function a(a){for(var c,d=a.target.files,e=0;c=d[e];e++){var f={name:escape(c.name),size:c.size,uploaded:-1,file:c};b.work(f)}}window.console.log("setup - setupFileSelect");var b=this;window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser."),document.getElementById("files").addEventListener("change",a,!1)},goog.require("X.parserDCM"),goog.require("X.parser"),goog.require("X.renderer3D");var Visualization=function(a){this.db=a,this.r3d=null,this.volume=null};Visualization.prototype.setup=function(){var a=this;document.addEventListener("dbAdded",function(){window.console.log("data added!"),a.cleanUI(),a.db.getAllDataItems(function(b){a.onsuccessGetAllDataItems(b)})},!1),document.addEventListener("dbLoaded",function(){window.console.log("data loaded!"),a.cleanUI(),a.db.getAllDataItems(function(b){a.onsuccessGetAllDataItems(b)})},!1),document.addEventListener("dbRemoved",function(){window.console.log("data removed!"),a.cleanUI(),a.db.getAllDataItems(function(b){a.onsuccessGetAllDataItems(b)})},!1)},Visualization.prototype.cleanUI=function(){window.console.log("cleaning UI");var a=document.getElementById("dataItems");a.innerHTML=""},Visualization.prototype.renderData=function(a){var b=this,c=document.getElementById("dataItems"),d=document.createElement("li"),e=document.createElement("a"),f=document.createElement("a"),g=document.createTextNode(a.name+" ");e.addEventListener("click",function(){window.console.log("start preview"),window.console.log(a),null!==b.r3d&&(b.r3d.destroy(),delete b.r3d,b.r3d=null),null!==b.volume&&(delete b.volume,b.volume=null),window.console.log("new 3d renderer"),b.r3d=new X.renderer3D,b.r3d.container="3d",b.r3d.init(),b.volume=new X.volume,b.volume.file=a.name+".dcm",b.volume.filedata=a.content,b.r3d.add(b.volume),b.r3d.render()}),e.href="#",e.textContent="[Preview]",f.addEventListener("click",function(){b.db.deleteData(a.uid)}),f.href="#",f.textContent="[Delete]",d.appendChild(g),d.appendChild(e),d.appendChild(f),c.appendChild(d)},Visualization.prototype.onsuccessGetAllDataItems=function(a){var b=a.target.result;!!b!=!1&&(this.renderData(b.value),b.continue())};var Collaboration=function(a){this.db=a,this.tmp={},this.tmp2={},this.status={}};Collaboration.prototype.setup=function(){var a=this;TogetherJS.hub.on("togetherjs.hello",function(b){b.sameUrl&&a.db.getAllDataItems(function(b){a.onsuccessSendAllDataItems(b)})}),TogetherJS.hub.on("dataSend",function(b){if(b.sameUrl){var c=(Math.pow(2,16),b.content);if(a.tmp.hasOwnProperty(b.uid)||(a.tmp[b.uid]={},a.status[b.uid]=0,window.console.log("Create container: "+b.uid+" - "+c.length)),window.console.log("size: "+c.length),window.console.log("_this.status[msg.uid] : "+a.status[b.uid]),window.console.log("msg.total : "+b.total),a.status[b.uid]+=1,a.tmp[b.uid][b.index]=c,a.status[b.uid]===b.total){var d="",e=0;for(e=0;e<=b.total;e++)d+=a.tmp[b.uid][e];window.console.log("fullString: "+d.length);var f={name:b.name,size:"000",file:null,content:str2ab(d),uid:b.uid};a.db.addData(f)}}})},Collaboration.prototype.onsuccessSendAllDataItems=function(a){var b=a.target.result;if(0!=!!b){var c=new Uint16Array(b.value.content),d=c.length;window.console.log("abLength: "+d);var e,f,g=Math.pow(2,16),h=Math.ceil(d/g),i=0,j="";for(e=0;d>e;e+=g){f=Math.min(g,d-e);var k=String.fromCharCode.apply(null,c.subarray(e,e+f));window.console.log("index: "+i+"  size: "+k.length),TogetherJS.send({type:"dataSend",name:b.value.name,content:k,uid:b.value.uid,total:h,index:i}),i++,j+=k}window.console.log("fullString: "+j.length),b.continue()}};var Slicedrop2=function(){};Slicedrop2.prototype.init=function(){console.log("-- DOM content loaded --"),console.log("-- Setup DB--");var a=new Db;a.open(),console.log("-- Setup Uploader--");var b=new Upload(a);b.setup(),console.log("-- Setup GIU/Viewer--");var c=new Visualization(a);c.setup(),console.log("-- Setup Collaboration--");var d=new Collaboration(a);d.setup()},window.addEventListener("DOMContentLoaded",init,!1);